err en ballade?<%=naverr%><br>
<div id="gauche" style="float:left;background-color:#CCCCCC;width:250px;height:500px">
	<table id="le_tableau">

	<tr>
	<td>DATE</td><td>View</td><td>Del</td>
	</td>
	<% for(var t=0;t<list.length;t++) 
	{%>
		<tr class='mesreducs'>
		<td><%=moment(list[t].PRE_DATE).format("YYYY-MM-DD HH:mm:ss")%></td><td><div class='noeil' datas='<%=moment(list[t].PRE_DATE).format("YYYY-MM-DD HH:mm:ss")%>'></div></td><td><div class='trash' datas='<%=moment(list[t].PRE_DATE).format("YYYY-MM-DD HH:mm:ss")%>'></div></td><td></td>
		</tr>
	<%}%>
	</table>
</div>
<div id="droite" style="float:left;background-color:#EEEEEE;width:700px;height:500px">
	<div id="compare_a_prediction" style="float:top;width:90%;height:9%;background-color:#63c9e2">
		<div id="div_tirage_compare" style="float:left"></div>
		<div id="previous" datas="" class="previous" style="float:left"></div>
		<div id="div_date_compare" style="float:left"><%=moment().format("YYYY-MM-DD HH:mm:ss")%></div>
		
		<div id="next" datas="" class="next" style="float:left"></div>
	</div>

	<div id="div_load_a_prediction" style="float:bottom;width:90%;height:90%;background-color:#a9dbe8">

	</div>




</div>
<script>
function print_and_compare(tirage) {
	
	var idx = tirage.TIR_DATE;
	//alerte ("compare " + idx);
	$("#next").attr("datas", idx);
	$("#previous").attr("datas", idx);
	$("#div_date_compare").html(idx);
	
	var cct = "<div class='case' style='float:left'>" + tirage.TIR_1 + "</div>";
	cct += "<div class='case' >" + tirage.TIR_2 + "</div>";
	cct += "<div class='case' >" + tirage.TIR_3 + "</div>";
	cct += "<div class='case' >" + tirage.TIR_4 + "</div>";
	cct += "<div class='case' >" + tirage.TIR_5 + "</div>";
	cct += "<div class='case_comp' >" + tirage.TIR_C + "</div>";
	$("#div_tirage_compare").html(cct);

	var trs = $("#table_pr").find('tr') ;

	var nbLignes = trs.length;
	//alert ("nbLignes " + nbLignes);
	console.log("le nb ligne",nbLignes);
	var ttl_gains = 0;
	var ttl_maconnerie = 0;
	for (var cpt=0;cpt<nbLignes;cpt++) {
		var gains = {
						"r0c": 2.2, 
						"r1c": 2.2,
						"r2": 5, 
						"r2c": 10, 
						"r3": 20, 
						"r3c": 50, 
						"r4": 500, 
						"r4c": 1000, 
						"r5": 100000, 
						"r5c": 1000000
					};

		var instance = 0;
		var complementaire = "";
		//nm1
		var nm1 = trs.eq(cpt).find('td').eq(0).text();
		//alert ("num1 " + nm1);
		if(nm1 == tirage.TIR_1 || nm1 == tirage.TIR_2 || nm1 == tirage.TIR_3 || nm1 == tirage.TIR_4 || nm1 == tirage.TIR_5) {
			instance ++;
			trs.eq(cpt).find('td').eq(0).addClass("case_sel");
		} else trs.eq(cpt).find('td').eq(0).removeClass("case_sel");
		
		//nm2
		var nm2 = trs.eq(cpt).find('td').eq(1).text();
		
		if(nm2 == tirage.TIR_1 || nm2 == tirage.TIR_2 || nm2 == tirage.TIR_3 || nm2 == tirage.TIR_4 || nm2 == tirage.TIR_5) {
		
			instance ++;
			trs.eq(cpt).find('td').eq(1).addClass("case_sel");
		} else trs.eq(cpt).find('td').eq(1).removeClass("case_sel");
		//alert("fin nm2");
		//nm3
		var nm3 = trs.eq(cpt).find('td').eq(2).text();
		if(nm3 == tirage.TIR_1 || nm3 == tirage.TIR_2 || nm3 == tirage.TIR_3 || nm3 == tirage.TIR_4 || nm3 == tirage.TIR_5) {
			instance ++;
			trs.eq(cpt).find('td').eq(2).addClass("case_sel");
		} else trs.eq(cpt).find('td').eq(2).removeClass("case_sel");

		var nm4 = trs.eq(cpt).find('td').eq(3).text();
		if(nm4 == tirage.TIR_1 || nm4 == tirage.TIR_2 || nm4 == tirage.TIR_3 || nm4 == tirage.TIR_4 || nm4 == tirage.TIR_5) {
			instance ++;
			trs.eq(cpt).find('td').eq(3).addClass("case_sel");
		} else trs.eq(cpt).find('td').eq(3).removeClass("case_sel");

		var nm5 = trs.eq(cpt).find('td').eq(4).text();
		if(nm5 == tirage.TIR_1 || nm5 == tirage.TIR_2 || nm5 == tirage.TIR_3 || nm5 == tirage.TIR_4 || nm5 == tirage.TIR_5) {
			instance ++;
			trs.eq(cpt).find('td').eq(4).addClass("case_sel");
		} else trs.eq(cpt).find('td').eq(4).removeClass("case_sel");


		var nmc = trs.eq(cpt).find('td').eq(5).text();
		if(nmc == tirage.TIR_C) {
			trs.eq(cpt).find('td').eq(5).addClass("case_sel");
			trs.eq(cpt).find('td').eq(7).html("complémentaire");
			complementaire = "c";
			//alert("vu");
		} else {
			trs.eq(cpt).find('td').eq(5).removeClass("case_sel");
			trs.eq(cpt).find('td').eq(7).html(" ");
			complementaire = "";
		}
		
		if (instance > 1) 
			trs.eq(cpt).find('td').eq(6).html(instance + " numéros");
		else 
			trs.eq(cpt).find('td').eq(6).html(" ");	
		//alert('zb');
		
		var curr_gains = "r" + instance + complementaire;
		//alert(curr_gains);
		
		if(gains[curr_gains] != undefined) {
			var objS = trs.eq(cpt).find('td').eq(9).find("input");
			var flag = objS.prop("checked");
			if(flag){
				ttl_gains += gains[curr_gains];

			}
			else {
				ttl_maconnerie += gains[curr_gains];
			}
			//if(complementaire != "") alert(gains[curr_gains]);
		}
		instance = 0;

	}
	var cout = 2.2 * (nbLignes / 2);
	var solde = (ttl_gains - cout);
	solde = parseInt(solde * 100) / 100;
	var couillonnade = "";
	if (ttl_maconnerie > 0) {
		couillonnade = ", mais ma connerie a couté : " + ttl_maconnerie;
	}
	var debrief_gains = "Cout : " + cout + ", gains : " + ttl_gains + ", solde : " + solde + couillonnade;
	if ((ttl_gains - cout) > 0) {
		$("#estimations").css("background-color", "#b9f4b0");
	} else {
		$("#estimations").css("background-color", "#fc7e7e");
	}
	$("#estimations"). html(debrief_gains);

}


$("#previous").click(function(){
	var idx = $("#div_date_compare").html();
	//alert("previuous date : " + idx);
	$.get('/tirages/getmoinsun',{'ladate': idx},function(get_tirage) {
			get_tirage = JSON.parse(get_tirage);
			if(get_tirage.err != null && get_tirage.err != "") {
				alert(get_tirage.err);
			} else {
				$( "#div_date_compare" ).html(get_tirage.resultat.TIR_DATE);
				print_and_compare(get_tirage.resultat);
			}
	});
});

$("#next").click(function(){
	var idx = $("#div_date_compare").html();
	//alert('next : ' + idx);
	$.get('/tirages/getplusun',{'ladate': idx},function(get_tirage) {
			get_tirage = JSON.parse(get_tirage);
			//alert('elors? date : ' + get_tirage.TIR_DATE);
			$("#next").attr("datas", idx);
		    $("#previous").attr("datas", idx);

			if(get_tirage.err != null && get_tirage.err != "") {
				alert("err : " + get_tirage.err);
			} else {
				$( "#div_date_compare" ).html(get_tirage.resultat.TIR_DATE);
				print_and_compare(get_tirage.resultat);
			}
	});
});
//Pour infos rappel, parse du tb html : .find("td").eq(0).text()

$(".noeil").each(function(){
	$(this).click(function() {

		var idx = $(this).attr("datas");
		//alert('datas : ' + idx);
		//$("#next").attr("datas", idx);
		//$("#previous").attr("datas", idx);
		
		$.get('/predictions/load',{'ladate': idx},function(result_load) {
			
			$( "#div_load_a_prediction" ).html(result_load);
		});
		//alert('juste avant ' + idx);
		$.get('tirages/getplusun',{'ladate': idx},function(get_tirage) {
			
			get_tirage = JSON.parse(get_tirage);
			//alert("extraction date : " + get_tirage.resultat.TIR_DATE);
			if(get_tirage.err != null && get_tirage.err != "") {
				alert(get_tirage.err);
			} else {
				$( "#div_date_compare" ).html(get_tirage.resultat.TIR_DATE);
				print_and_compare(get_tirage.resultat);
			}
		});

	});
});
$(".trash").each(function(){
	$(this).click(function() {
		var idx = $(this).attr("datas");
		$.get('predictions/delete',{'ladate': idx},function(result_load) {
			$( "#div_load_prediction" ).html(result_load);
		});
	});

});



</script>